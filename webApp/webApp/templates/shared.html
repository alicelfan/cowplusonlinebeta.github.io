{% extends "base.html" %}
{% block title %}COW Plus | Shared{% endblock %}
{% block linkdownload %}class = "active"{% endblock %}
{% block content %}
{% for file_data in file_contents %}
    <div>
        <h4>{{ file_data.filename }}:</h4>
        <form action="/shared_delete" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Delete</button>
        </form>
        <form action="/shared_download" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Download</button>
        </form>
        <form action="/import" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Import</button>
        </form>
        <form action="/shared_preview" method="post" style="display:inline;">
            <input type="hidden" name="filename" value="{{ file_data.filename }}">
            <button type="submit">Preview</button>
        </form>
    </div>
    <br>
{% endfor %}

<form id="file-upload-form" action="/shared.html" method="post" enctype="multipart/form-data">
    <div class="drop-area" id="drop-area">
        <p>Drag & Drop your files here or click to select files</p>
        <input type="file" id="file-input" name="file" multiple style="display: none;">
    </div>
    <ul id="file-list"></ul>
    <div id="metadata-container" style="display: none;">
        <div>
            <label for="citation">Manual citation (Chicago):</label>
            <br>
            <textarea id="citation" name="citation" rows="4" cols="50" required></textarea>
        </div>
    </div>
    <button type="submit" style="display: none;" id="upload-button">Upload</button>
</form>

<style>
    .drop-area {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }
    .drop-area.dragging {
        background-color: #f0f0f0;
        border-color: #00bfff;
    }
    #metadata-container > div {
        margin-bottom: 10px;
    }
</style>

<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const metadataContainer = document.getElementById('metadata-container');
    const uploadButton = document.getElementById('upload-button');

    dropArea.addEventListener('click', () => fileInput.click());

    dropArea.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropArea.classList.add('dragging');
    });

    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('dragging');
    });

    dropArea.addEventListener('drop', (event) => {
        event.preventDefault();
        dropArea.classList.remove('dragging');

        // Get the dropped files
        const files = event.dataTransfer.files;
        handleFiles(files);
    });

    function handleFiles(files) {
        // Add files to the input element's files property
        const dataTransfer = new DataTransfer();
        for (const file of files) {
            dataTransfer.items.add(file);
        }
        fileInput.files = dataTransfer.files;

        // Clear previous file list
        fileList.innerHTML = '';
        // Display file names
        for (const file of files) {
            const listItem = document.createElement('li');
            listItem.textContent = file.name;
            fileList.appendChild(listItem);
        }

        // Show the metadata input and upload button
        metadataContainer.style.display = 'block';
        uploadButton.style.display = 'block';
    }

    fileInput.addEventListener('change', () => {
        handleFiles(fileInput.files);
    });
</script>
{% endblock %}
